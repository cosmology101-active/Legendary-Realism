# Tag the player who crafted Filtered Water
tag @s add crafting_player

# Damage the Primitive Filter in the player's inventory (slots 0-8 cover crafting grid)
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:0b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}]}] run data modify entity @s Inventory[{Slot:0b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}] components."minecraft:damage" merge value 1b
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:1b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}]}] run data modify entity @s Inventory[{Slot:1b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}] components."minecraft:damage" merge value 1b
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:2b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}]}] run data modify entity @s Inventory[{Slot:2b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}] components."minecraft:damage" merge value 1b
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:3b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}]}] run data modify entity @s Inventory[{Slot:3b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}] components."minecraft:damage" merge value 1b
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:4b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}]}] run data modify entity @s Inventory[{Slot:4b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}] components."minecraft:damage" merge value 1b
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:5b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}]}] run data modify entity @s Inventory[{Slot:5b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}] components."minecraft:damage" merge value 1b
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:6b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}]}] run data modify entity @s Inventory[{Slot:6b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}] components."minecraft:damage" merge value 1b
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:7b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}]}] run data modify entity @s Inventory[{Slot:7b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}] components."minecraft:damage" merge value 1b
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:8b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}]}] run data modify entity @s Inventory[{Slot:8b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004}}}] components."minecraft:damage" merge value 1b

# Break the filter if damage reaches 5 in any slot
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:0b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004},"minecraft:damage":5}}}]] run replaceitem entity @s container.0 air
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:1b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004},"minecraft:damage":5}}}]] run replaceitem entity @s container.1 air
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:2b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004},"minecraft:damage":5}}}]] run replaceitem entity @s container.2 air
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:3b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004},"minecraft:damage":5}}}]] run replaceitem entity @s container.3 air
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:4b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004},"minecraft:damage":5}}}]] run replaceitem entity @s container.4 air
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:5b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004},"minecraft:damage":5}}}]] run replaceitem entity @s container.5 air
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:6b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004},"minecraft:damage":5}}}]] run replaceitem entity @s container.6 air
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:7b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004},"minecraft:damage":5}}}]] run replaceitem entity @s container.7 air
execute as @a[tag=crafting_player] at @s if entity @s[nbt={Inventory:[{Slot:8b,id:"minecraft:gunpowder",components:{"minecraft:custom_data":{"custom_model_data":1004},"minecraft:damage":5}}}]] run replaceitem entity @s container.8 air

# Clean up the tag and reset advancement
tag @a[tag=crafting_player] remove crafting_player
advancement revoke @a only crafting:use_primitive_filter
